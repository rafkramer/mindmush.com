import{s as p}from"./CdPPWCzV.js";import{v as i}from"./BQ8b0Sla.js";import{m as c}from"./IT3EpKRj.js";async function w(a){try{const e=new Date().toISOString().split("T")[0],o=`https://r.applovin.com/maxReport?api_key=${a}&start=${e}&end=${e}&format=json&columns=day,application`,t=await fetch(o);return t.ok?{success:!0}:{success:!1,error:await t.text()||"Invalid API response"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Connection failed"}}}async function f(a,e,o){const{applovinApiKey:t}=c(p);if(!t||!a)return null;try{const n=`https://r.applovin.com/maxReport?api_key=${t}&start=${e}&end=${o}&format=json&columns=day,estimated_revenue&filter_application=${a}`,l=await fetch(n);if(l.ok){const r=await l.json();if(r.results&&r.results.length>0)return r.results.reduce((s,u)=>s+(parseFloat(String(u.estimated_revenue))||0),0)}return null}catch(n){return console.error("AppLovin fetch error:",n),null}}async function d(a,e,o){if(!a)return null;try{const t=`https://api.superwall.com/api/v1/analytics/revenue?start_date=${e}&end_date=${o}`,n=await fetch(t,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(n.ok){const l=await n.json();return l.total_revenue||l.revenue||null}return null}catch(t){return console.error("Superwall fetch error:",t),null}}async function g(){const a=c(i),{applovinApiKey:e}=c(p),o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1).toISOString().split("T")[0],n=o.toISOString().split("T")[0];let l=0,r=0;for(const s of a)if(!(s.state==="building"||s.state==="killed"))try{let u=null;s.type==="game"&&s.bundleId&&e?u=await f(s.bundleId,t,n):s.type==="app"&&s.superwallKey&&(u=await d(s.superwallKey,t,n)),u!==null&&(i.update(s.id,{revenue:(s.revenue||0)+u}),l++)}catch{r++}return{updated:l,errors:r}}async function h(a){const e=i.get(a);if(!e)return{success:!1,error:"Venture not found"};if(e.state==="building"||e.state==="killed")return{success:!1,error:"Venture is not in a syncable state"};const{applovinApiKey:o}=c(p),t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1).toISOString().split("T")[0],l=t.toISOString().split("T")[0];try{let r=null;return e.type==="game"&&e.bundleId&&o?r=await f(e.bundleId,n,l):e.type==="app"&&e.superwallKey&&(r=await d(e.superwallKey,n,l)),r!==null?(i.update(e.id,{revenue:r}),{success:!0,revenue:r}):{success:!1,error:"No revenue data available or API not configured"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Sync failed"}}}export{h as a,g as s,w as t};
